{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u043F\\u043E\\u0440\\u0442\\u0444\\u043E\\u043B\\u0456\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0439 \\u0447\\u0430\\u0442\\\\chat\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import ChatList from'../ChatList/ChatList';import ChatView from'../ChatViev/Chatviev';import ChatTextBox from'../ChatTextBox/ChatTextBox';import styles from'./Style';import{Button,withStyles}from'@material-ui/core';var firebase=require(\"firebase\");var Dashbord=/*#__PURE__*/function(_React$Component){_inherits(Dashbord,_React$Component);function Dashbord(){var _this;_classCallCheck(this,Dashbord);_this=_possibleConstructorReturn(this,_getPrototypeOf(Dashbord).call(this));_this.signOut=function(){return firebase.auth().signOut();};_this.selectChat=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(chatIndex){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.setState({selectedChat:chatIndex});case 2:_this.messageRead();case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.submitMessage=function(msg){var docKey=_this.buildDocKey(_this.state.chats[_this.state.selectedChat].users.filter(function(_usr){return _usr!==_this.state.email;})[0]);firebase.firestore().collection('chats').doc(docKey).update({messages:firebase.firestore.FieldValue.arrayUnion({sender:_this.state.email,message:msg,timestap:Date.now()}),receiverHasRed:false});};_this.buildDocKey=function(friend){return[_this.state.email,friend].sort().join(':');};_this.newChatBtnClicked=function(){return _this.setState({newChatFormVisible:true,selectedChat:null});};_this.messageRead=function(){var docKey=_this.buildDocKey(_this.state.chats[_this.state.selectedChat].users.filter(function(_usr){return _usr!==_this.state.email;})[0]);if(_this.clicKedChatWhereNotSen(_this.state.selectedChat)){firebase.firestore().collection('chats').doc(docKey).update({receiverHasRed:true});}else{}};_this.clicKedChatWhereNotSen=function(chatIndex){return _this.state.chats[chatIndex].messages[_this.state.chats[chatIndex].messages.length-1].sender!==_this.state.email;};_this.componentDidMount=function(){firebase.auth().onAuthStateChanged(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_usr){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(_usr){_context3.next=4;break;}_this.props.history.push('/login');_context3.next=6;break;case 4:_context3.next=6;return firebase.firestore().collection('chats').where('users','array-contains',_usr.email).onSnapshot(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(res){var chats;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:chats=res.docs.map(function(_doc){return _doc.data();});_context2.next=3;return _this.setState({email:_usr.email,chats:chats});case 3:console.log(_this.state);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref3.apply(this,arguments);};}());case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref2.apply(this,arguments);};}());};_this.state={selectedChat:null,newChatFormVisible:false,email:null,chats:[]};return _this;}_createClass(Dashbord,[{key:\"render\",value:function render(){var classes=this.props.classes;return React.createElement(\"div\",null,React.createElement(ChatList,{history:this.props.history,newChatBtnFunction:this.newChatBtnClicked,selectChatFunction:this.selectChat,chats:this.state.chats,userEmail:this.state.email,selectChatIndex:this.state.selectedChat}),this.state.newChatFormVisible?null:React.createElement(ChatView,{user:this.state.email,chat:this.state.chats[this.state.selectedChat]}),this.state.selectedChat!==null&&!this.state.newChatFormVisible?React.createElement(ChatTextBox,{submitMessageFN:this.submitMessage,messageChatFN:this.messageRead}):null,React.createElement(Button,{className:classes.signOutBtn,onClick:this.signOut},\"\\u0412\\u0438\\u0439\\u0442\\u0438\"));}}]);return Dashbord;}(React.Component);export default withStyles(styles)(Dashbord);","map":{"version":3,"sources":["C:/Users/nazar/Desktop/портфоліо простий чат/chat/src/Dashbord/Dashbord.js"],"names":["React","ChatList","ChatView","ChatTextBox","styles","Button","withStyles","firebase","require","Dashbord","signOut","auth","selectChat","chatIndex","setState","selectedChat","messageRead","submitMessage","msg","docKey","buildDocKey","state","chats","users","filter","_usr","email","firestore","collection","doc","update","messages","FieldValue","arrayUnion","sender","message","timestap","Date","now","receiverHasRed","friend","sort","join","newChatBtnClicked","newChatFormVisible","clicKedChatWhereNotSen","length","componentDidMount","onAuthStateChanged","props","history","push","where","onSnapshot","res","docs","map","_doc","data","console","log","classes","signOutBtn","Component"],"mappings":"wnDAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,sBAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,sBAArB,CACA,MAAOC,CAAAA,WAAP,KAAwB,4BAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,SAAnB,CACA,OAASC,MAAT,CAAiBC,UAAjB,KAAmC,mBAAnC,CACA,GAAMC,CAAAA,QAAQ,CAAGC,OAAO,CAAC,UAAD,CAAxB,C,GAEMC,CAAAA,Q,8EACF,mBAAa,0CACT,4EADS,MAwCjBC,OAxCiB,CAwCP,iBAAMH,CAAAA,QAAQ,CAACI,IAAT,GAAgBD,OAAhB,EAAN,EAxCO,OAyCjBE,UAzCiB,0FAyCJ,iBAAOC,SAAP,wIACJ,OAAKC,QAAL,CAAc,CAACC,YAAY,CAAEF,SAAf,CAAd,CADI,QAEV,MAAKG,WAAL,GAFU,sDAzCI,qEA6CjBC,aA7CiB,CA6CD,SAACC,GAAD,CAAQ,CACpB,GAAMC,CAAAA,MAAM,CAAG,MAAKC,WAAL,CAAiB,MAAKC,KAAL,CAAWC,KAAX,CAAiB,MAAKD,KAAL,CAAWN,YAA5B,EAA0CQ,KAA1C,CAAgDC,MAAhD,CAAuD,SAAAC,IAAI,QAAIA,CAAAA,IAAI,GAAK,MAAKJ,KAAL,CAAWK,KAAxB,EAA3D,EAA0F,CAA1F,CAAjB,CAAf,CACAnB,QAAQ,CACPoB,SADD,GAECC,UAFD,CAEY,OAFZ,EAGCC,GAHD,CAGKV,MAHL,EAICW,MAJD,CAIQ,CACJC,QAAQ,CAAExB,QAAQ,CAACoB,SAAT,CAAmBK,UAAnB,CAA8BC,UAA9B,CAAyC,CAChDC,MAAM,CAAE,MAAKb,KAAL,CAAWK,KAD6B,CAEhDS,OAAO,CAAGjB,GAFsC,CAGhDkB,QAAQ,CAAEC,IAAI,CAACC,GAAL,EAHsC,CAAzC,CADN,CAMJC,cAAc,CAAE,KANZ,CAJR,EAYH,CA3DgB,OA6DjBnB,WA7DiB,CA6DH,SAACoB,MAAD,QAAW,CAAC,MAAKnB,KAAL,CAAWK,KAAZ,CAAmBc,MAAnB,EAA2BC,IAA3B,GAAkCC,IAAlC,CAAuC,GAAvC,CAAX,EA7DG,OA8DjBC,iBA9DiB,CA8DG,iBAAM,OAAK7B,QAAL,CAAc,CAAC8B,kBAAkB,CAAE,IAArB,CAA2B7B,YAAY,CAAE,IAAzC,CAAd,CAAN,EA9DH,OA+DjBC,WA/DiB,CA+DH,UAAK,CACf,GAAMG,CAAAA,MAAM,CAAG,MAAKC,WAAL,CAAiB,MAAKC,KAAL,CAAWC,KAAX,CAAiB,MAAKD,KAAL,CAAWN,YAA5B,EAA0CQ,KAA1C,CAAgDC,MAAhD,CAAuD,SAAAC,IAAI,QAAIA,CAAAA,IAAI,GAAK,MAAKJ,KAAL,CAAWK,KAAxB,EAA3D,EAA0F,CAA1F,CAAjB,CAAf,CACA,GAAG,MAAKmB,sBAAL,CAA4B,MAAKxB,KAAL,CAAWN,YAAvC,CAAH,CAAwD,CACpDR,QAAQ,CACPoB,SADD,GAECC,UAFD,CAEY,OAFZ,EAGCC,GAHD,CAGKV,MAHL,EAICW,MAJD,CAIQ,CAACS,cAAc,CAAE,IAAjB,CAJR,EAKH,CAND,IAMO,CAEN,CACJ,CA1EgB,OA4EjBM,sBA5EiB,CA4EQ,SAAChC,SAAD,QAAe,OAAKQ,KAAL,CAAWC,KAAX,CAAiBT,SAAjB,EAA4BkB,QAA5B,CAAqC,MAAKV,KAAL,CAAWC,KAAX,CAAiBT,SAAjB,EAA4BkB,QAA5B,CAAqCe,MAArC,CAA6C,CAAlF,EAAqFZ,MAArF,GAAgG,MAAKb,KAAL,CAAWK,KAA1H,EA5ER,OA8EjBqB,iBA9EiB,CA8EG,UAAK,CACrBxC,QAAQ,CAACI,IAAT,GAAgBqC,kBAAhB,2FAAmC,kBAAMvB,IAAN,yHAC3BA,IAD2B,0BAE/B,MAAKwB,KAAL,CAAWC,OAAX,CAAmBC,IAAnB,CAAwB,QAAxB,EAF+B,qDAIrB5C,CAAAA,QAAQ,CACboB,SADK,GAELC,UAFK,CAEM,OAFN,EAGLwB,KAHK,CAGC,OAHD,CAGU,gBAHV,CAG4B3B,IAAI,CAACC,KAHjC,EAIL2B,UAJK,2FAIM,kBAAMC,GAAN,gIACFhC,KADE,CACMgC,GAAG,CAACC,IAAJ,CAASC,GAAT,CAAa,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAACC,IAAL,EAAJ,EAAjB,CADN,wBAEF,OAAK5C,QAAL,CAAc,CAChBY,KAAK,CAAED,IAAI,CAACC,KADI,CAEhBJ,KAAK,CAAEA,KAFS,CAAd,CAFE,QAMRqC,OAAO,CAACC,GAAR,CAAY,MAAKvC,KAAjB,EANQ,wDAJN,iEAJqB,yDAAnC,kEAkBH,CAjGgB,CAET,MAAKA,KAAL,CAAY,CACRN,YAAY,CAAE,IADN,CAER6B,kBAAkB,CAAE,KAFZ,CAGRlB,KAAK,CAAE,IAHC,CAIRJ,KAAK,CAAE,EAJC,CAAZ,CAFS,aAQZ,C,4DACG,IACIuC,CAAAA,OADJ,CACgB,KAAKZ,KADrB,CACIY,OADJ,CAER,MACI,gCACI,oBAAC,QAAD,EAAU,OAAO,CAAE,KAAKZ,KAAL,CAAWC,OAA9B,CACA,kBAAkB,CAAE,KAAKP,iBADzB,CAEA,kBAAkB,CAAE,KAAK/B,UAFzB,CAGA,KAAK,CAAE,KAAKS,KAAL,CAAWC,KAHlB,CAIA,SAAS,CAAI,KAAKD,KAAL,CAAWK,KAJxB,CAKA,eAAe,CAAE,KAAKL,KAAL,CAAWN,YAL5B,EADJ,CASQ,KAAKM,KAAL,CAAWuB,kBAAX,CACA,IADA,CAEA,oBAAC,QAAD,EACA,IAAI,CAAE,KAAKvB,KAAL,CAAWK,KADjB,CAEA,IAAI,CAAE,KAAKL,KAAL,CAAWC,KAAX,CAAiB,KAAKD,KAAL,CAAWN,YAA5B,CAFN,EAXR,CAiBQ,KAAKM,KAAL,CAAWN,YAAX,GAA4B,IAA5B,EAAoC,CAAE,KAAKM,KAAL,CAAWuB,kBAAjD,CACA,oBAAC,WAAD,EACA,eAAe,CAAE,KAAK3B,aADtB,CAEA,aAAa,CAAE,KAAKD,WAFpB,EADA,CAIkB,IArB1B,CAwBI,oBAAC,MAAD,EAAQ,SAAS,CAAE6C,OAAO,CAACC,UAA3B,CAAuC,OAAO,CAAE,KAAKpD,OAArD,mCAxBJ,CADJ,CA4BC,C,sBAxCsBV,KAAK,CAAC+D,S,EAqG7B,cAAezD,CAAAA,UAAU,CAACF,MAAD,CAAV,CAAmBK,QAAnB,CAAf","sourcesContent":["import React from 'react';\r\nimport ChatList from '../ChatList/ChatList';\r\nimport ChatView from '../ChatViev/Chatviev';\r\nimport ChatTextBox from '../ChatTextBox/ChatTextBox';\r\nimport styles from './Style';\r\nimport { Button, withStyles } from '@material-ui/core';\r\nconst firebase = require(\"firebase\");\r\n\r\nclass Dashbord extends React.Component {\r\n    constructor(){\r\n        super();\r\n        this.state= {\r\n            selectedChat: null,\r\n            newChatFormVisible: false,\r\n            email: null,\r\n            chats: []\r\n        }\r\n    }\r\nrender(){\r\n    const { classes } = this.props;\r\nreturn(\r\n    <div>\r\n        <ChatList history={this.props.history}\r\n        newChatBtnFunction={this.newChatBtnClicked}\r\n        selectChatFunction={this.selectChat}\r\n        chats={this.state.chats}\r\n        userEmail = {this.state.email}\r\n        selectChatIndex={this.state.selectedChat} \r\n        ></ChatList>\r\n        {\r\n            this.state.newChatFormVisible ?\r\n            null :\r\n            <ChatView\r\n            user={this.state.email}\r\n            chat={this.state.chats[this.state.selectedChat]}\r\n            ></ChatView>\r\n        }\r\n        {\r\n            this.state.selectedChat !== null && ! this.state.newChatFormVisible ?\r\n            <ChatTextBox\r\n            submitMessageFN={this.submitMessage}\r\n            messageChatFN={this.messageRead}\r\n            ></ChatTextBox> : null\r\n        }\r\n        \r\n        <Button className={classes.signOutBtn} onClick={this.signOut}>Вийти</Button>\r\n    </div>\r\n)\r\n}\r\nsignOut = () => firebase.auth().signOut();\r\nselectChat = async (chatIndex) =>{\r\n   await this.setState({selectedChat: chatIndex});\r\n   this.messageRead();\r\n}\r\nsubmitMessage = (msg) =>{\r\n    const docKey = this.buildDocKey(this.state.chats[this.state.selectedChat].users.filter(_usr => _usr !== this.state.email)[0]);\r\n    firebase\r\n    .firestore()\r\n    .collection('chats')\r\n    .doc(docKey)\r\n    .update({\r\n        messages: firebase.firestore.FieldValue.arrayUnion({\r\n           sender: this.state.email,\r\n           message:  msg,\r\n           timestap: Date.now()\r\n        }),\r\n        receiverHasRed: false\r\n    })\r\n}\r\n\r\nbuildDocKey = (friend) =>[this.state.email, friend].sort().join(':');\r\nnewChatBtnClicked = () => this.setState({newChatFormVisible: true, selectedChat: null});\r\nmessageRead = () =>{\r\n    const docKey = this.buildDocKey(this.state.chats[this.state.selectedChat].users.filter(_usr => _usr !== this.state.email)[0]);\r\n    if(this.clicKedChatWhereNotSen(this.state.selectedChat)){\r\n        firebase\r\n        .firestore()\r\n        .collection('chats')\r\n        .doc(docKey)\r\n        .update({receiverHasRed: true})\r\n    } else {\r\n\r\n    }\r\n}\r\n\r\nclicKedChatWhereNotSen = (chatIndex) => this.state.chats[chatIndex].messages[this.state.chats[chatIndex].messages.length -1].sender !== this.state.email;\r\n\r\ncomponentDidMount = () =>{\r\n    firebase.auth().onAuthStateChanged(async _usr =>{\r\n        if(!_usr)\r\n        this.props.history.push('/login');\r\n        else{\r\n            await firebase\r\n            .firestore()\r\n            .collection('chats')\r\n            .where('users', 'array-contains', _usr.email)\r\n            .onSnapshot(async res =>{\r\n                const chats = res.docs.map(_doc => _doc.data());\r\n                await this.setState({\r\n                    email: _usr.email,\r\n                    chats: chats\r\n                });\r\n                console.log(this.state)\r\n            })\r\n        }\r\n    })\r\n}\r\n}\r\n\r\nexport default withStyles(styles)(Dashbord);"]},"metadata":{},"sourceType":"module"}