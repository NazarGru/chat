{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\nazar\\\\Desktop\\\\\\u041D\\u043E\\u0432\\u0430 \\u043F\\u0430\\u043F\\u043A\\u0430 (2)\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{FormControl,InputLabel,Input,Button,Paper,withStyles,CssBaseline,Typography}from'@material-ui/core';import styles from'./Style';var firebase=require(\"firebase\");var NewChatComponent=/*#__PURE__*/function(_React$Component){_inherits(NewChatComponent,_React$Component);function NewChatComponent(){var _this;_classCallCheck(this,NewChatComponent);_this=_possibleConstructorReturn(this,_getPrototypeOf(NewChatComponent).call(this));_this.userTyping=function(inputType,e){switch(inputType){case'username':_this.setState({username:e.target.value});break;case'message':_this.setState({message:e.target.value});break;default:break;}};_this.submitNewChat=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var userExists,chatExists;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return _this.userExists();case 3:userExists=_context.sent;if(!userExists){_context.next=9;break;}_context.next=7;return _this.chatExists();case 7:chatExists=_context.sent;chatExists?_this.goToChat():_this.createChat();case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.buildDocKey=function(){return[firebase.auth().currentUser.email,_this.state.username].sort().join(':');};_this.createChat=function(){_this.props.newChatSubmitFn({sendTo:_this.state.username,message:_this.state.message});};_this.goToChat=function(){return _this.props.goToChatFn(_this.buildDocKey(),_this.state.message);};_this.chatExists=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var docKey,chat;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:docKey=_this.buildDocKey();_context2.next=3;return firebase.firestore().collection('chats').doc(docKey).get();case 3:chat=_context2.sent;console.log(chat.exists);return _context2.abrupt(\"return\",chat.exists);case 6:case\"end\":return _context2.stop();}}},_callee2);}));_this.userExists=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var usersSnapshot,exists;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return firebase.firestore().collection('users').get();case 2:usersSnapshot=_context3.sent;exists=usersSnapshot.docs.map(function(_doc){return _doc.data().email;}).includes(_this.state.username);_this.setState({serverError:!exists});return _context3.abrupt(\"return\",exists);case 6:case\"end\":return _context3.stop();}}},_callee3);}));_this.state={username:null,message:null};return _this;}_createClass(NewChatComponent,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;return React.createElement(\"main\",{className:classes.main},React.createElement(CssBaseline,null),React.createElement(Paper,{className:classes.paper},React.createElement(Typography,{component:\"h1\",variant:\"h5\"},\"\\u0417\\u043D\\u0430\\u0439\\u0442\\u0438 \\u043A\\u043E\\u0440\\u0438\\u0441\\u0442\\u0443\\u0432\\u0430\\u0447\\u0430!\"),React.createElement(\"form\",{className:classes.form,onSubmit:function onSubmit(e){return _this2.submitNewChat(e);}},React.createElement(FormControl,{fullWidth:true},React.createElement(InputLabel,{htmlFor:\"new-chat-username\"},\"\\u0412\\u0432\\u0435\\u0434\\u0456\\u0442\\u044C \\u0435\\u043C\\u0430\\u0456\\u043B \\u043A\\u043E\\u0440\\u0438\\u0441\\u0442\\u0443\\u0432\\u0430\\u0447\\u0430\"),React.createElement(Input,{required:true,className:classes.input,autoFocus:true,onChange:function onChange(e){return _this2.userTyping('username',e);},id:\"new-chat-username\"})),React.createElement(FormControl,{fullWidth:true},React.createElement(InputLabel,{htmlFor:\"new-chat-message\"},\"\\u0412\\u0430\\u0448\\u0435 \\u043F\\u043E\\u0432\\u0456\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u043D\\u044F\"),React.createElement(Input,{required:true,className:classes.input,onChange:function onChange(e){return _this2.userTyping('message',e);},id:\"new-chat-message\"})),React.createElement(Button,{fullWidth:true,variant:\"contained\",color:\"primary\",className:classes.submit,type:\"submit\"},\"\\u0412\\u0456\\u0434\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u0438\")),this.state.serverError?React.createElement(Typography,{component:\"h5\",variant:\"h6\",className:classes.errorText},\"\\u0442\\u0430\\u043A\\u043E\\u0433\\u043E \\u043A\\u043E\\u0440\\u0438\\u0441\\u0442\\u0443\\u0432\\u0430\\u0447\\u0430 \\u043D\\u0435 \\u0456\\u0441\\u043D\\u0443\\u0454\"):null));}},{key:\"componentWillMount\",value:function componentWillMount(){if(!firebase.auth().currentUser)this.props.history.push('/login');}}]);return NewChatComponent;}(React.Component);export default withStyles(styles)(NewChatComponent);","map":{"version":3,"sources":["C:/Users/nazar/Desktop/Нова папка (2)/src/NewChat/NewChat.js"],"names":["React","FormControl","InputLabel","Input","Button","Paper","withStyles","CssBaseline","Typography","styles","firebase","require","NewChatComponent","userTyping","inputType","e","setState","username","target","value","message","submitNewChat","preventDefault","userExists","chatExists","goToChat","createChat","buildDocKey","auth","currentUser","email","state","sort","join","props","newChatSubmitFn","sendTo","goToChatFn","docKey","firestore","collection","doc","get","chat","console","log","exists","usersSnapshot","docs","map","_doc","data","includes","serverError","classes","main","paper","form","input","submit","errorText","history","push","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { FormControl, InputLabel, Input, Button, Paper, withStyles, CssBaseline, Typography } from '@material-ui/core';\r\nimport styles from './Style';\r\nconst firebase = require(\"firebase\");\r\n\r\nclass NewChatComponent extends React.Component {\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      username: null,\r\n      message: null\r\n    };\r\n  }\r\n\r\n  render() {\r\n\r\n    const { classes } = this.props;\r\n\r\n    return(\r\n      <main className={classes.main}>\r\n        <CssBaseline/>\r\n        <Paper className={classes.paper}>\r\n          <Typography component=\"h1\" variant=\"h5\">Знайти користувача!</Typography>\r\n          <form className={classes.form} onSubmit={(e) => this.submitNewChat(e)}>\r\n            <FormControl fullWidth>\r\n              <InputLabel htmlFor='new-chat-username'>\r\n                  Введіть емаіл користувача\r\n              </InputLabel>\r\n              <Input required \r\n                className={classes.input}\r\n                autoFocus \r\n                onChange={(e) => this.userTyping('username', e)} \r\n                id='new-chat-username'>\r\n              </Input>\r\n            </FormControl>\r\n            <FormControl fullWidth>\r\n              <InputLabel htmlFor='new-chat-message'>\r\n                  Ваше повідомлення\r\n              </InputLabel>\r\n              <Input required \r\n                className={classes.input}\r\n                onChange={(e) => this.userTyping('message', e)} \r\n                id='new-chat-message'>\r\n              </Input>\r\n            </FormControl>\r\n            <Button fullWidth variant='contained' color='primary' className={classes.submit} type='submit'>Відправити</Button>\r\n          </form>\r\n          {\r\n            this.state.serverError ? \r\n            <Typography component='h5' variant='h6' className={classes.errorText}>\r\n              такого користувача не існує\r\n            </Typography> :\r\n            null\r\n          }\r\n        </Paper>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  componentWillMount() {\r\n    if(!firebase.auth().currentUser)\r\n      this.props.history.push('/login');\r\n  }\r\n\r\n  userTyping = (inputType, e) => {\r\n    switch (inputType) {\r\n      case 'username':\r\n        this.setState({ username: e.target.value });\r\n        break;\r\n      \r\n      case 'message':\r\n        this.setState({ message: e.target.value });\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  submitNewChat = async (e) => {\r\n    e.preventDefault();\r\n    const userExists = await this.userExists();\r\n    if(userExists) {\r\n      const chatExists = await this.chatExists();\r\n      chatExists ? this.goToChat() : this.createChat();\r\n    }\r\n  }\r\n\r\n  buildDocKey = () => [firebase.auth().currentUser.email, this.state.username].sort().join(':');\r\n\r\n  createChat = () => {\r\n    this.props.newChatSubmitFn({\r\n      sendTo: this.state.username,\r\n      message: this.state.message\r\n    });\r\n  }\r\n\r\n  goToChat = () => this.props.goToChatFn(this.buildDocKey(), this.state.message);\r\n\r\n  chatExists = async () => {\r\n    const docKey = this.buildDocKey();\r\n    const chat = await \r\n      firebase\r\n      .firestore()\r\n      .collection('chats')\r\n      .doc(docKey)\r\n      .get();\r\n    console.log(chat.exists);\r\n    return chat.exists;\r\n  }\r\n  userExists = async () => {\r\n    const usersSnapshot = await \r\n    firebase\r\n      .firestore()\r\n      .collection('users')\r\n      .get();\r\n    const exists = usersSnapshot\r\n      .docs\r\n        .map(_doc => _doc.data().email)\r\n        .includes(this.state.username);\r\n    this.setState({ serverError: !exists });\r\n    return exists;\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(NewChatComponent);"]},"metadata":{},"sourceType":"module"}